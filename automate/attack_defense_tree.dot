digraph AttackDefenseTree {
    graph [
        fontname="Arial",
        splines=ortho,
        nodesep=0.5,
        ranksep=0.75,
        rankdir=TB,
        ordering="out",
        compound=true,
        label="ECS Privilege Escalation Attack-Defense Tree\nDefense Supply Chain Management System",
        labelloc="t",
        fontsize=16
    ];
    node [fontname="Arial"];

    // ============================================================================
    // ROOT NODE
    // ============================================================================
    "Root_Node" [label="Root Node: Compromised IAM Credentials\nDefense Supply Chain CI/CD Environment",
        shape=rectangle, style=filled, fillcolor="#C6E8D1", fontcolor="black"];

    // ============================================================================
    // BRANCH 1: CREATE USER DATA SCRIPT FOR ECS CLUSTER REGISTRATION
    // ============================================================================
    
    "1.0-Preventive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>1.0 Preventive: IAM Permission Boundaries &amp; Least Privilege</b><br/>
            <b>Classification: Preventive</b><br/>
            <b>Description:</b> Enforce strict IAM policies preventing unauthorized ec2:RunInstances<br/>
            and iam:PassRole permissions. Implement permission boundaries on all CI/CD roles<br/>
            to prevent privilege escalation. Use Service Control Policies (SCPs) to deny<br/>
            EC2 instance launches outside approved AMI IDs and instance profiles.<br/>
            <b>AWS Services:</b> IAM, AWS Organizations (SCPs), IAM Access Analyzer<br/>
            <b>Implementation:</b> Deny ec2:RunInstances unless AMI matches approved golden AMI list.<br/>
            Deny iam:PassRole unless target role is in approved ECS instance profile whitelist.<br/>
        >, margin=0.2
    ];

    "1.1-Attack" [
        shape=rectangle, style=filled, fillcolor="#F40B0B", fontcolor="white",
        label=<
            <b>1.1 Attack: Create User Data Script for ECS Cluster Registration</b><br/>
            <b>Command:</b> cat &gt; /tmp/asd.sh &lt;&lt; 'EOF'<br/>
            #!/bin/bash<br/>
            echo ECS_CLUSTER=defense-supply-chain-cluster &gt;&gt; /etc/ecs/ecs.config;<br/>
            echo ECS_BACKEND_HOST= &gt;&gt; /etc/ecs/ecs.config;<br/>
            EOF<br/>
            <b>Dependencies:</b> Local file system access on attacker workstation or compromised<br/>
            CI/CD EC2 instance. Knowledge of target ECS cluster name (defense-supply-chain-cluster).<br/>
            <b>Result:</b> Malicious user data script created to auto-register rogue EC2 instance<br/>
            to production ECS cluster hosting ammunition tracking, medical supply management,<br/>
            and rations distribution containers.<br/>
            <b>TTP:</b> T1059.004 - Command and Scripting Interpreter: Unix Shell<br/>
            <b>Mission Context:</b> Target cluster runs classified supply chain workloads with<br/>
            access to SECRET-level operational data across global military bases.<br/>
        >, margin=0.2
    ];

    "1.2-Detective" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>1.2 Detective: File Integrity Monitoring &amp; Behavioral Analytics</b><br/>
            <b>Classification: Detective</b><br/>
            <b>Description:</b> Deploy AIDE/Tripwire on all CI/CD EC2 instances to detect unauthorized<br/>
            file creation in /tmp directories. CloudWatch Logs Insights queries for suspicious<br/>
            bash script creation patterns. GuardDuty detects unusual file system activity.<br/>
            <b>AWS Services:</b> CloudWatch Logs, GuardDuty, Systems Manager (Run Command for FIM)<br/>
            <b>Detection Logic:</b> Alert on file creation in /tmp with ECS_CLUSTER configuration strings.<br/>
            Correlate with IAM principal activity to identify compromised credentials.<br/>
            <b>Alert Threshold:</b> MEDIUM severity - Potential reconnaissance activity detected.<br/>
        >, margin=0.2
    ];

    "1.3-Reactive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>1.3 Reactive: Automated Credential Revocation &amp; Session Termination</b><br/>
            <b>Classification: Reactive</b><br/>
            <b>Description:</b> Lambda function triggered by CloudWatch Events immediately revokes<br/>
            IAM credentials associated with suspicious file creation activity. Terminate active<br/>
            sessions via STS. Quarantine affected EC2 instance by applying isolation security group.<br/>
            <b>AWS Services:</b> Lambda, EventBridge, IAM, EC2, SNS<br/>
            <b>Automated Actions:</b><br/>
            1. Revoke IAM user access keys or EC2 instance profile credentials<br/>
            2. Terminate all active sessions for compromised principal<br/>
            3. Apply sg-quarantine to affected EC2 instance (deny all traffic)<br/>
            4. Create forensic EBS snapshot for investigation<br/>
            5. Notify SOC via PagerDuty (MEDIUM severity escalation)<br/>
            <b>MTTR Target:</b> &lt; 5 minutes from detection to credential revocation<br/>
        >, margin=0.2
    ];

    "1.4-Chaos" [
        shape=rectangle, style="filled,rounded,bold", fillcolor="#FC8600", color="#FFA500", fontcolor="#000000",
        label=<
            <b>1.4 Security Chaos Engineering Experiment</b><br/>
            <b>Preventive Probe:</b> Attempt to create user data script with compromised IAM role<br/>
            lacking ec2:RunInstances permission. Verify IAM policy denies action with explicit deny.<br/>
            Expected Result: Access Denied error, CloudTrail logs unauthorized attempt.<br/>
            <b>Detective Probe:</b> Create benign test script in /tmp with ECS_CLUSTER string on<br/>
            monitored CI/CD instance. Verify CloudWatch Logs Insights query triggers alert within<br/>
            2 minutes. Confirm GuardDuty generates finding for unusual file system activity.<br/>
            Expected Result: Alert generated, visible in Security Hub within SLA.<br/>
            <b>Reactive Probe:</b> Simulate detection event via EventBridge test event. Verify Lambda<br/>
            function executes credential revocation, session termination, and quarantine actions.<br/>
            Confirm forensic snapshot created and SOC notification sent.<br/>
            Expected Result: All reactive actions complete within 5-minute MTTR target.<br/>
            <b>Validation Frequency:</b> Monthly chaos drill, quarterly red team exercise<br/>
        >, margin=0.2
    ];

    // ============================================================================
    // BRANCH 2: LAUNCH EC2 INSTANCE WITH ECS CONFIGURATION
    // ============================================================================

    "2.0-Preventive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>2.0 Preventive: EC2 Launch Controls &amp; AMI Whitelisting</b><br/>
            <b>Classification: Preventive</b><br/>
            <b>Description:</b> Enforce EC2 instance launch restrictions via SCP and IAM policies.<br/>
            Only allow launches from approved golden AMIs (CIS/STIG hardened, signed by AWS Signer).<br/>
            Require IMDSv2 enforcement at launch. Deny iam:PassRole for non-approved instance profiles.<br/>
            Restrict instance launches to approved VPC subnets (private subnets only).<br/>
            <b>AWS Services:</b> AWS Organizations (SCP), IAM, EC2, AWS Signer<br/>
            <b>Implementation:</b> SCP denies ec2:RunInstances unless ImageId matches approved AMI list<br/>
            AND IamInstanceProfile matches approved ECS instance profile ARNs AND IMDSv2 is required.<br/>
            <b>Approved AMI Pattern:</b> ami-* signed by defense-supply-chain-signer key<br/>
            <b>Approved Instance Profiles:</b> arn:aws:iam::*:instance-profile/ecs-supply-chain-*<br/>
        >, margin=0.2
    ];

    "2.1-Attack" [
        shape=rectangle, style=filled, fillcolor="#F40B0B", fontcolor="white",
        label=<
            <b>2.1 Attack: Launch Malicious EC2 Instance with ECS Configuration</b><br/>
            <b>Command:</b> aws ec2 run-instances \<br/>
            --image-id ami-07fde2ae86109a2af \<br/>
            --instance-type t2.micro \<br/>
            --iam-instance-profile ecs-supply-chain-cicd-role \<br/>
            --count 1 --key-name attacker-key \<br/>
            --user-data "file:///tmp/asd.sh" \<br/>
            --subnet-id subnet-private-cicd \<br/>
            --security-group-ids sg-cicd-default<br/>
            <b>Dependencies:</b> ec2:RunInstances permission, iam:PassRole for ECS instance profile,<br/>
            Valid ECS-optimized AMI ID, Existing IAM instance profile with ECS permissions<br/>
            (ecs:RegisterContainerInstance, ecs:DeregisterContainerInstance, ecs:DiscoverPollEndpoint),<br/>
            SSH key pair for instance access, Network access to ECS cluster endpoint.<br/>
            <b>Result:</b> Rogue EC2 instance launches in CI/CD private subnet, auto-registers to<br/>
            defense-supply-chain-cluster. ECS scheduler begins placing ammunition tracking,<br/>
            medical supply, and rations distribution tasks on compromised instance.<br/>
            <b>TTP:</b> T1578.002 - Create Cloud Instance<br/>
            <b>Mission Impact:</b> CRITICAL - Attacker gains foothold in production ECS cluster,<br/>
            positioned to intercept classified supply chain workloads and extract credentials.<br/>
        >, margin=0.2
    ];

    "2.2-Detective" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>2.2 Detective: CloudTrail Analysis &amp; ECS Cluster Monitoring</b><br/>
            <b>Classification: Detective</b><br/>
            <b>Description:</b> Real-time CloudTrail monitoring for ec2:RunInstances API calls.<br/>
            GuardDuty detects unauthorized EC2 instance launches. AWS Config rules validate<br/>
            instance compliance (approved AMI, IMDSv2, approved instance profile). ECS cluster<br/>
            monitoring detects new container instance registrations from unknown IP addresses.<br/>
            <b>AWS Services:</b> CloudTrail, GuardDuty, Config, ECS, EventBridge, CloudWatch<br/>
            <b>Detection Logic:</b><br/>
            1. CloudTrail: Alert on ec2:RunInstances with non-approved AMI ID<br/>
            2. Config Rule: ec2-approved-amis-by-id (non-compliant = alert)<br/>
            3. GuardDuty: UnauthorizedAccess:EC2/MaliciousIPCaller.Custom (if known bad IP)<br/>
            4. ECS API: DescribeContainerInstances - detect new registrations, validate EC2 metadata<br/>
            5. VPC Flow Logs: Unusual traffic patterns from new instance to ECS endpoints<br/>
            <b>Alert Threshold:</b> HIGH severity - Unauthorized EC2 instance launch detected<br/>
            <b>MTTD Target:</b> &lt; 2 minutes from instance launch to alert generation<br/>
        >, margin=0.2
    ];

    "2.3-Reactive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>2.3 Reactive: Automated Instance Termination &amp; Cluster Isolation</b><br/>
            <b>Classification: Reactive</b><br/>
            <b>Description:</b> Step Functions workflow orchestrates immediate response to unauthorized<br/>
            EC2 instance launch. Deregister rogue container instance from ECS cluster, terminate<br/>
            EC2 instance, revoke associated IAM credentials, capture forensic data.<br/>
            <b>AWS Services:</b> Step Functions, Lambda, ECS, EC2, IAM, S3, SNS<br/>
            <b>Automated Response Workflow:</b><br/>
            1. ECS DeregisterContainerInstance (force=true) - remove from cluster immediately<br/>
            2. EC2 CreateSnapshot - capture EBS volumes for forensic analysis<br/>
            3. EC2 TerminateInstances - destroy rogue instance<br/>
            4. IAM DeleteAccessKey / EC2 DisassociateIamInstanceProfile - revoke credentials<br/>
            5. S3 PutObject - store forensic snapshot metadata in immutable bucket<br/>
            6. SNS Publish - notify SOC and CISO (HIGH severity, PagerDuty escalation)<br/>
            7. CloudTrail LookupEvents - analyze blast radius of compromised credentials<br/>
            8. ECS DescribeTasks - identify if any tasks were scheduled on rogue instance<br/>
            9. If tasks found: trigger container forensic analysis workflow<br/>
            <b>MTTR Target:</b> &lt; 10 minutes from detection to instance termination<br/>
            <b>Forensic Preservation:</b> All artifacts stored in S3 with Object Lock (WORM)<br/>
        >, margin=0.2
    ];

    "2.4-Chaos" [
        shape=rectangle, style="filled,rounded,bold", fillcolor="#FC8600", color="#FFA500", fontcolor="#000000",
        label=<
            <b>2.4 Security Chaos Engineering Experiment</b><br/>
            <b>Preventive Probe:</b> Attempt to launch EC2 instance with non-approved AMI ID using<br/>
            test IAM role. Verify SCP denies action. Attempt to pass non-approved instance profile.<br/>
            Verify IAM policy denies iam:PassRole. Attempt to launch without IMDSv2 enforcement.<br/>
            Expected Result: All attempts denied, CloudTrail logs show explicit deny decisions.<br/>
            <b>Detective Probe:</b> Launch approved test EC2 instance in isolated test subnet with<br/>
            monitoring enabled. Verify CloudTrail event captured within 30 seconds. Confirm Config<br/>
            rule evaluation triggers within 2 minutes. Simulate ECS container instance registration<br/>
            from test instance, verify ECS API monitoring detects new registration.<br/>
            Expected Result: All detection mechanisms trigger alerts within MTTD SLA (2 minutes).<br/>
            <b>Reactive Probe:</b> Trigger Step Functions workflow with test event simulating unauthorized<br/>
            instance launch. Verify workflow executes all steps: ECS deregistration, snapshot creation,<br/>
            instance termination, credential revocation, forensic storage, SOC notification.<br/>
            Validate forensic snapshot stored in S3 with Object Lock enabled. Confirm PagerDuty alert.<br/>
            Expected Result: Complete workflow execution within 10-minute MTTR target, all artifacts preserved.<br/>
            <b>Validation Frequency:</b> Monthly automated chaos test, quarterly red team simulation<br/>
        >, margin=0.2
    ];

    // ============================================================================
    // BRANCH 3: ACCESS CONTAINERS AND EXTRACT ECS TASK ROLE CREDENTIALS
    // ============================================================================

    "3.0-Preventive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>3.0 Preventive: Container Runtime Security &amp; Network Segmentation</b><br/>
            <b>Classification: Preventive</b><br/>
            <b>Description:</b> Harden Docker runtime on ECS container instances. Disable SSH access<br/>
            (use Systems Manager Session Manager only). Implement container runtime security policies<br/>
            preventing docker exec from host. Use AWS Fargate for sensitive workloads (no host access).<br/>
            Network segmentation prevents lateral movement from compromised instances.<br/>
            <b>AWS Services:</b> ECS (Fargate), Systems Manager, Security Groups, NACLs, VPC<br/>
            <b>Implementation:</b><br/>
            1. Disable SSH (port 22) via security group rules - use SSM Session Manager only<br/>
            2. Docker daemon configured with --live-restore=false, --userland-proxy=false<br/>
            3. AppArmor/SELinux profiles restrict docker exec capabilities<br/>
            4. ECS task definitions use awsvpc network mode (isolated network namespace)<br/>
            5. Security groups enforce microsegmentation (task-to-task communication only)<br/>
            6. NACL rules block metadata service access from container subnets (169.254.169.254/32)<br/>
            7. Migrate classified workloads to Fargate (no EC2 host access possible)<br/>
            <b>Critical Workloads on Fargate:</b> Ammunition tracking, medical supply databases<br/>
        >, margin=0.2
    ];

    "3.1-Attack" [
        shape=rectangle, style=filled, fillcolor="#F40B0B", fontcolor="white",
        label=<
            <b>3.1 Attack: Access Containers and Extract ECS Task Role Credentials</b><br/>
            <b>Command:</b> ssh -i attacker-key.pem ec2-user@&lt;rogue-instance-ip&gt;<br/>
            docker ps<br/>
            docker exec -it &lt;ammunition-tracking-container-id&gt; /bin/sh<br/>
            curl http://169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI<br/>
            # Extract credentials for ecs-task-role-ammunition-tracking<br/>
            # Credentials provide access to:<br/>
            # - S3 bucket: s3://defense-supply-chain-ammunition-data (SECRET classification)<br/>
            # - DynamoDB table: ammunition-inventory-global (real-time tracking)<br/>
            # - RDS database: medical-supplies-db (HIPAA + classified patient data)<br/>
            <b>Dependencies:</b> SSH access to rogue EC2 instance, ECS tasks scheduled on compromised<br/>
            instance, Docker runtime access, Network connectivity to AWS metadata service (169.254.170.2).<br/>
            <b>Result:</b> Attacker extracts IAM credentials for ECS task roles with elevated permissions:<br/>
            - ecs-task-role-ammunition-tracking (S3, DynamoDB, Secrets Manager access)<br/>
            - ecs-task-role-medical-supplies (RDS, S3, KMS decrypt for HIPAA data)<br/>
            - ecs-task-role-rations-distribution (S3, Lambda invoke, SNS publish)<br/>
            Credentials valid for 1-12 hours (default ECS task role session duration).<br/>
            <b>TTP:</b> T1552.005 - Unsecured Credentials: Cloud Instance Metadata API<br/>
            <b>Mission Impact:</b> CRITICAL - Privilege escalation achieved. Attacker can now:<br/>
            - Exfiltrate classified ammunition inventory data (SECRET level)<br/>
            - Access medical supply databases with patient information (HIPAA violation)<br/>
            - Manipulate rations distribution data (supply chain integrity compromise)<br/>
            - Pivot to additional AWS services using stolen credentials<br/>
            <b>STRIDE Goals Achieved:</b> Elevation of Privilege, Information Disclosure<br/>
        >, margin=0.2
    ];

    "3.2-Detective" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>3.2 Detective: Container Runtime Monitoring &amp; Credential Usage Analysis</b><br/>
            <b>Classification: Detective</b><br/>
            <b>Description:</b> Deploy container runtime security monitoring (Falco, Sysdig) to detect<br/>
            docker exec commands. CloudTrail data events track ECS task role credential usage.<br/>
            GuardDuty detects anomalous API calls from ECS task credentials. VPC Flow Logs identify<br/>
            unusual metadata service access patterns. CloudWatch Container Insights monitors runtime behavior.<br/>
            <b>AWS Services:</b> CloudTrail, GuardDuty, VPC Flow Logs, CloudWatch, EventBridge<br/>
            <b>Detection Logic:</b><br/>
            1. Falco rule: Detect "docker exec" commands on ECS container instances<br/>
            2. VPC Flow Logs: Alert on traffic to 169.254.170.2 (ECS task metadata endpoint)<br/>
            3. CloudTrail: Monitor API calls using ECS task role credentials from unusual source IPs<br/>
            4. GuardDuty: UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS<br/>
            5. CloudWatch Logs Insights: Query for curl/wget commands targeting metadata service<br/>
            6. Behavioral analytics: Detect ECS task credentials used outside expected VPC/region<br/>
            7. S3 access logs: Unusual access patterns to s3://defense-supply-chain-ammunition-data<br/>
            <b>Alert Threshold:</b> CRITICAL severity - Container escape + credential theft detected<br/>
            <b>MTTD Target:</b> &lt; 3 minutes from docker exec to alert generation<br/>
            <b>Correlation:</b> Link docker exec event → metadata access → API call with stolen creds<br/>
        >, margin=0.2
    ];

    "3.3-Reactive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>3.3 Reactive: Emergency Credential Revocation &amp; Incident Response</b><br/>
            <b>Classification: Reactive</b><br/>
            <b>Description:</b> Immediate revocation of compromised ECS task role credentials. Terminate<br/>
            all ECS tasks using affected task roles. Isolate compromised EC2 instance. Initiate<br/>
            full incident response workflow including forensic analysis, blast radius assessment,<br/>
            and breach notification (classified data exposure).<br/>
            <b>AWS Services:</b> Lambda, Step Functions, ECS, IAM, STS, EC2, S3, SNS, Security Hub<br/>
            <b>Automated Response Workflow (CRITICAL Severity):</b><br/>
            1. STS GetCallerIdentity - identify compromised task role ARN<br/>
            2. IAM AttachRolePolicy - attach explicit deny-all policy to compromised task role<br/>
            3. ECS StopTask - terminate all tasks using compromised task role (force=true)<br/>
            4. ECS UpdateService - update service to use new task role with rotated credentials<br/>
            5. EC2 ModifyInstanceAttribute - disable source/dest check, apply quarantine SG<br/>
            6. EC2 CreateSnapshot - capture memory dump and EBS volumes for forensics<br/>
            7. CloudTrail LookupEvents - analyze all API calls made with stolen credentials<br/>
            8. S3 GetObjectVersions - identify data accessed in ammunition/medical/rations buckets<br/>
            9. KMS DescribeKey - check if encryption keys were accessed<br/>
            10. Secrets Manager DescribeSecret - verify if secrets were retrieved<br/>
            11. Generate incident report with blast radius assessment<br/>
            12. Notify CISO, Security Lead, and Military Command (CRITICAL escalation)<br/>
            13. Initiate breach notification process (classified data exposure protocol)<br/>
            14. Trigger forensic analysis workflow in isolated VPC<br/>
            15. Rotate all related credentials (task roles, instance profiles, access keys)<br/>
            <b>MTTR Target:</b> &lt; 5 minutes from detection to credential revocation<br/>
            <b>Breach Notification:</b> Immediate notification to DoD Cyber Crime Center (DC3)<br/>
            <b>Forensic Preservation:</b> All artifacts stored in S3 with MFA Delete + Object Lock<br/>
            <b>Recovery Actions:</b> Rebuild ECS cluster from golden AMIs, redeploy workloads to Fargate<br/>
        >, margin=0.2
    ];

    "3.4-Chaos" [
        shape=rectangle, style="filled,rounded,bold", fillcolor="#FC8600", color="#FFA500", fontcolor="#000000",
        label=<
            <b>3.4 Security Chaos Engineering Experiment</b><br/>
            <b>Preventive Probe:</b> Attempt to SSH into production ECS container instance using test<br/>
            credentials. Verify security group blocks port 22. Attempt docker exec command via SSM<br/>
            Session Manager. Verify AppArmor/SELinux policy denies action. Attempt to access metadata<br/>
            service (169.254.170.2) from test container. Verify NACL blocks traffic.<br/>
            Expected Result: All access attempts denied, no SSH connectivity, docker exec blocked.<br/>
            <b>Detective Probe:</b> In isolated test environment, simulate docker exec command on test<br/>
            ECS instance. Verify Falco generates alert within 30 seconds. Simulate metadata service<br/>
            access from test container. Verify VPC Flow Logs capture traffic and trigger alert.<br/>
            Use test ECS task credentials to make API call from unauthorized IP. Verify GuardDuty<br/>
            detects anomalous credential usage within 5 minutes. Confirm all alerts visible in Security Hub.<br/>
            Expected Result: All detection mechanisms trigger within MTTD SLA (3 minutes).<br/>
            <b>Reactive Probe:</b> Trigger Step Functions incident response workflow with simulated<br/>
            credential theft event. Verify workflow executes all 15 steps: credential revocation,<br/>
            task termination, instance quarantine, forensic capture, blast radius analysis, notifications.<br/>
            Validate incident report generated with complete timeline. Confirm CISO notification sent<br/>
            via PagerDuty. Verify forensic artifacts stored in S3 with MFA Delete enabled.<br/>
            Expected Result: Complete workflow execution within 5-minute MTTR, all stakeholders notified,<br/>
            forensic chain of custody maintained, breach notification process initiated.<br/>
            <b>Validation Frequency:</b> Monthly automated chaos test, quarterly red team exercise,<br/>
            annual DoD IG audit simulation<br/>
            <b>Success Criteria:</b> 100% detection rate, &lt;5min MTTR, zero false negatives<br/>
        >, margin=0.2
    ];

    // ============================================================================
    // FINAL NODE
    // ============================================================================

    "Final_Node" [label=<
        <b>Final Attack Goal Achieved</b><br/>
        <b>STRIDE Classification:</b> Elevation of Privilege, Information Disclosure<br/>
        <b>Impact:</b> Attacker gained unauthorized access to classified supply chain data<br/>
        (ammunition inventory, medical supplies, rations distribution) via stolen ECS<br/>
        task role credentials. Potential exfiltration of SECRET-level operational data<br/>
        affecting warfighter readiness across global military bases.<br/>
        <b>Mission Compromise:</b> CRITICAL - Supply chain integrity threatened<br/>
    >,
        shape=rectangle, style=filled, fillcolor="#8B0000", fontcolor="white"];

    // ============================================================================
    // GRAPH STRUCTURE - ATTACK PATH FLOW
    // ============================================================================

    // Branch 1: User Data Script Creation
    {rank=same; "1.4-Chaos"; "1.1-Attack"}
    {rank=same; "1.2-Detective"; "1.3-Reactive"}

    "Root_Node" -> "1.0-Preventive";
    "1.0-Preventive" -> "1.1-Attack";
    "1.1-Attack" -> "1.2-Detective";
    "1.1-Attack" -> "1.3-Reactive";
    "1.1-Attack" -> "1.4-Chaos" [style=dashed, color="#FC8600"];

    // Branch 2: EC2 Instance Launch
    {rank=same; "2.4-Chaos"; "2.1-Attack"}
    {rank=same; "2.2-Detective"; "2.3-Reactive"}

    "1.2-Detective" -> "2.0-Preventive";
    "1.3-Reactive" -> "2.0-Preventive";
    "2.0-Preventive" -> "2.1-Attack";
    "2.1-Attack" -> "2.2-Detective";
    "2.1-Attack" -> "2.3-Reactive";
    "2.1-Attack" -> "2.4-Chaos" [style=dashed, color="#FC8600"];

    // Branch 3: Credential Extraction
    {rank=same; "3.4-Chaos"; "3.1-Attack"}
    {rank=same; "3.2-Detective"; "3.3-Reactive"}

    "2.2-Detective" -> "3.0-Preventive";
    "2.3-Reactive" -> "3.0-Preventive";
    "3.0-Preventive" -> "3.1-Attack";
    "3.1-Attack" -> "3.2-Detective";
    "3.1-Attack" -> "3.3-Reactive";
    "3.1-Attack" -> "3.4-Chaos" [style=dashed, color="#FC8600"];

    // Final convergence
    "3.2-Detective" -> "Final_Node";
    "3.3-Reactive" -> "Final_Node";
}