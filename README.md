# Anticipating Adversary Behavior in DevSecOps Scenarios through Large Language Models

## Project Overview
This repository contains experimental materials and attack tree generation framework for analyzing adversary behavior patterns in DevSecOps pipelines using Large Language Models (LLMs). The work supports findings presented in our paper "Anticipating Adversary Behavior in DevSecOps Scenarios through Large Language Models" .

## Repository Structure
``` text
üìÅ Attack_Tree_Generation/
   üìÑ Prompts.txt          # Prompts used for attack tree generation
   üñºÔ∏è Flow_Diagram.png     # Workflow for attack tree construction
   üìë AttackProcedures.pdf # Attack procedures provided to LLMs
   üìë qwq.pdf              # Attack tree generated by QWQ_32B
   üìë gpt4.pdf             # Attack tree generated by GPT-4

üìÅ SCE_Experiment/
   üìÑ README.md            # Step-by-step replication guide
   üìÅ ...                  # Experiment-specific files
```

## Key Components

### Attack Tree Generation Framework
**Prompt Design** (`Attack_Tree_Generation/Prompts.txt`)  
Contains curated prompts used to guide LLMs in generating attack trees, following the methodology outlined in our paper.

**Methodology Workflow**  
![](Attack_Tree_Generation/Flow_Diagram.png)

**Generated Artifacts**  
- `qwq.pdf`: Attack tree diagram produced by QWQ_32B  
- `gpt4.pdf`: Additional attack tree from GPT-4  
- `AttackProcedures.pdf`: Technical specifications of analyzed attack vectors

## Experimental Validation
**SCE Experiment** (`SCE_Experiment/`)  
Contains complete materials to reproduce our security scenario evaluation with ChaosXploit framework:

### Overview 

The purpose of this experiment is to evaluate the resilience of an AWS environment to potential misuse of permissions. Specifically, the experiment will test whether an attacker can successfully request a Spot Instance, attach a privileged IAM role, and execute a reverse shell script to steal the IAM role credentials,using the permissions ec2:RequestSpotInstances and iam:PassRole.

### Quick Start

1. Navigate to the Runner folder and execute the installation script:
```bash
cd SCE_Experiment/Runner
./run.sh SCE_Experiment.json
```

The script will automatically:
- Create a virtual environment if it doesn't exist
- Install required dependencies
- Copy the modified files to the appropriate module location

### Making Changes

To modify the experiment behavior, edit these files:

- `actions.py`: Contains the actions to be executed during the experiment
- `probes.py`: Contains the probes used to verify system state

### Prerequisites

**1. AWS CLI Setup**  

```bash
aws configure set aws_access_key_id 
aws configure set aws_secret_access_key 
aws configure set region us-east-1
```

**2. IAM Policy Creation**

1. Navigate to [IAM Policies Console](https://console.aws.amazon.com/iam/)
2. Create policy ‚ûî JSON tab ‚ûî Paste:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "ec2:RequestSpotInstances",
                "iam:PassRole",
                "iam:ListUsers"
            ],
            "Resource": "*"
        }
    ]
}
```

1. Name: `EC2-CloudWatch-Agent-Policy` ‚ûî Create  

**3. IAM Role Creation**  
1. Create role ‚ûî Trusted entity: **AWS service** ‚ûî Use case: **EC2** 
2. Attach policy `EC2-CloudWatch-Agent-Policy`  
3. Name: `EC2-CloudWatch-Agent-Role`  
*(An IAM Instance Profile with matching name auto-generates)*  

**4. Token Configuration**  
```python
# In actions.py
NGROK_AUTHTOKEN = ""  # From https://dashboard.ngrok.com/get-started/your-authtoken
```


### üõ†Ô∏è Environment Checks  
| Tool               | Requirement          | Verification Command     |  
|--------------------|----------------------|--------------------------|  
| AWS CLI            | ‚â• v2.22.12            | `aws --version`          |  
| Python             | ‚â• 3.12                | `python3 --version`      |   

üí° **Key Notes**  
- IAM profile name must match role name for EC2 recognition  
- Region must remain **us-east-1** for experiment consistency

## Contact  
For technical questions: [mario.m.c@um.es](mailto:mario.m.c@um.es)